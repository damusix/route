define(["riot"],function(e){"use strict";e=e&&e.hasOwnProperty("default")?e["default"]:e;var t=function(e){e=e||{};var t={},n=Array.prototype.slice;Object.defineProperties(e,{on:{value:function(n,r){if(typeof r=="function"){(t[n]=t[n]||[]).push(r)}return e},enumerable:false,writable:false,configurable:false},off:{value:function(n,r){if(n=="*"&&!r){t={}}else{if(r){var i=t[n];for(var a=0,o;o=i&&i[a];++a){if(o==r){i.splice(a--,1)}}}else{delete t[n]}}return e},enumerable:false,writable:false,configurable:false},one:{value:function(t,n){function r(){e.off(t,r);n.apply(e,arguments)}return e.on(t,r)},enumerable:false,writable:false,configurable:false},trigger:{value:function(r){var i=arguments;var a=arguments.length-1,o=new Array(a),f,u,c;for(c=0;c<a;c++){o[c]=i[c+1]}f=n.call(t[r]||[],0);for(c=0;u=f[c];++c){u.apply(e,o)}if(t["*"]&&r!="*"){e.trigger.apply(e,["*",r].concat(o))}return e},enumerable:false,writable:false,configurable:false}});return e};var n=/^.+?\/\/+[^\/]+/,r="EventListener",i="remove"+r,a="add"+r,o="hasAttribute",f="popstate",u="hashchange",c="trigger",s=3,l=typeof window!="undefined"&&window,h=typeof document!="undefined"&&document,p=l&&history,d=l&&(p.location||l.location),v=K.prototype,m=h&&h.ontouchstart?"touchstart":"click",w=t();var g=false,y=false,b,_,$,A,O=[],P=0;function S(e){return e.split(/[\/?#]/)}function T(e,t){var n=t.replace(/\?/g,"\\?").replace(/\*/g,"([^/?#]+?)").replace(/\.\./,".*");var r=new RegExp("^"+n+"$");var i=e.match(r);if(i){return i.slice(1)}}function x(e,t){var n;return function(){clearTimeout(n);n=setTimeout(e,t)}}function E(e){b=x(F,1);l[a](f,b);l[a](u,b);h[a](m,q);if(e){F(true)}}function K(){this.$=[];t(this);w.on("stop",this.s.bind(this));w.on("emit",this.e.bind(this))}function N(e){return e.replace(/^\/|\/$/,"")}function j(e){return typeof e=="string"}function k(e){return(e||d.href).replace(n,"")}function B(e){var t=R._.base;return t[0]==="#"?(e||d.href||"").split(t)[1]||"":(d?k(e):e||"").replace(t,"")}function F(e){var t=P===0;if(s<=P){return}P++;O.push(function(){var t=B();if(e||t!==_){w[c]("emit",t);_=t}});if(t){var n;while(n=O.shift()){n()}P=0}}function q(e){if(e.which!==1||e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented){return}var t=e.target;while(t&&t.nodeName!=="A"){t=t.parentNode}if(!t||t.nodeName!=="A"||t[o]("download")||!t[o]("href")||t.target&&t.target!=="_self"||t.href.indexOf(d.href.match(n)[0])===-1){return}var r=R._.base;if(t.href!==d.href&&(t.href.split("#")[0]===d.href.split("#")[0]||r[0]!=="#"&&k(t.href).indexOf(r)!==0||r[0]==="#"&&t.href.split(r)[0]!==d.href.split(r)[0]||!D(B(t.href),t.title||h.title))){return}e.preventDefault()}function D(e,t,n){if(!p){return w[c]("emit",B(e))}e=R._.base+N(e);t=t||h.title;n?p.replaceState(null,t,e):p.pushState(null,t,e);h.title=t;y=false;F();return y}v.m=function(e,t,n){if(j(e)&&(!t||j(t))){D(e,t,n||false)}else if(t){this.r(e,t)}else{this.r("@",e)}};v.s=function(){this.off("*");this.$=[]};v.e=function(e){this.$.concat("@").some(function(t){var n=(t==="@"?$:A)(N(e),N(t));if(typeof n!="undefined"){this[c].apply(null,[t].concat(n));return y=true}},this)};v.r=function(e,t){if(e!=="@"){e="/"+N(e);this.$.push(e)}this.on(e,t)};var L=new K;var R=L.m.bind(L);R._={base:null,getPathFromBase:B};R.create=function(){var e=new K;var t=e.m.bind(e);t.stop=e.s.bind(e);return t};R.base=function(e){R._.base=e||"#";_=B()};R.exec=function(){F(true)};R.parser=function(e,t){if(!e&&!t){$=S;A=T}if(e){$=e}if(t){A=t}};R.query=function(){var e={};var t=d.href||_;t.replace(/[?&](.+?)=([^&]*)/g,function(t,n,r){e[n]=r});return e};R.stop=function(){if(g){if(l){l[i](f,b);l[i](u,b);h[i](m,q)}w[c]("stop");g=false}};R.start=function(e){if(!g){if(l){if(document.readyState==="interactive"||document.readyState==="complete"){E(e)}else{document.onreadystatechange=function(){if(document.readyState==="interactive"){setTimeout(function(){E(e)},1)}}}}g=true}};R.base();R.parser();e.tag2("router","<yield></yield>","","",function(e){var t=this;this.route=R.create();this.select=function(e){[].concat(t.tags.route).forEach(function(t){return t.show=t===e})};this.on("mount",function(){window.setTimeout(function(){return R.start(true)},0)});this.on("unmount",function(){t.route.stop()})});e.tag2("route",'<virtual if="{show}"><yield></yield></virtual>',"","",function(e){var t=this;this.show=false;var n=function(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];t.one("updated",function(){i(t.tags).forEach(function(t){t.trigger.apply(t,["route"].concat(e));t.update()})});t.parent.select(t);t.parent.update()};var r=!!window&&!!window.route&&!!window.route._?window.route._.getPathFromBase:function(){return""};if(e.path===r()){setTimeout(n,0)}this.parent.route(e.path,n);function i(e){return Object.keys(e).map(function(t){return e[t]}).reduce(function(e,t){return e.concat(t)},[])}});return R});