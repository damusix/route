define(function(){"use strict";const e="*";const t=Object.defineProperties;const n=Object.entries;const r=(e,t)=>(n,r)=>{if(e.has(n)){e.get(n).add(r)}else{e.set(n,(new Set).add(r))}return t};const i=(t,n)=>(r,i)=>{if(r===e&&!i){t.clear()}else{if(i){const e=t.get(r);if(e){e.delete(i);if(e.size===0)t.delete(r)}}else t.delete(r)}return n};const c=(e,t)=>(e,n)=>{function r(...i){t.off(e,r);n.apply(t,i)}return t.on(e,r)};const o=(t,n)=>(r,...i)=>{const c=t.get(r);if(c)c.forEach(e=>e.apply(n,i));if(t.get(e)&&r!==e){n.trigger(e,r,...i)}return n};const s=function(e){const s=new Map;const f={on:r,off:i,one:c,trigger:o};e=e||{};t(e,n(f).reduce((t,[n,r])=>{t[n]={value:r(s,e),enumerable:false,writable:false,configurable:false};return t},{}));return e};const f=/^.+?\/\/+[^\/]+/,a="EventListener",u=`remove${a}`,l=`add${a}`,d="hasAttribute",h="popstate",p="hashchange",m="trigger",_=3,b=typeof window!="undefined"&&window,g=typeof document!="undefined"&&document,S=b&&history,y=b&&(S.location||b.location),w=F.prototype,v=g&&g.ontouchstart?"touchstart":"click",P=s();function k(e){return e.split(/[\/?#]/)}function $(e,t){const n=t.replace(/\?/g,"\\?").replace(/\*/g,"([^/?#]+?)").replace(/\.\./,".*");const r=new RegExp(`^${n}$`);const i=e.match(r);if(i)return i.slice(1)}function E(e,t,n){return function(){clearTimeout(n);n=setTimeout(e,t)}}function L(e){D._.debouncedEmit=E(T,1);b[l](h,D._.debouncedEmit);b[l](p,D._.debouncedEmit);g[l](v,q);if(e)T(true)}function F(){this.$=[];s(this);P.on("stop",this.s.bind(this));P.on("emit",this.e.bind(this))}function x(e){return e.replace(/^\/|\/$/,"")}function O(e){return typeof e=="string"}function A(e){return(e||y.href).replace(f,"")}function K(e){const t=D._.base;return t[0]==="#"?(e||y.href||"").split(t)[1]||"":(y?A(e):e||"").replace(t,"")}function N(e,t){if(t){t();N(e,e.shift())}}function T(e){const t=D._.emitStackLevel===0;if(_<=D._.emitStackLevel)return;D._.emitStackLevel++;D._.emitStack.push(function(){const t=K();if(e||t!==D._.current){P[m]("emit",t);D._.current=t}});if(t){N(D._.emitStack,D._.emitStack.shift());D._.emitStackLevel=0}}function j(e){if(e.nodeName==="A")return e;j(e.parentNode)}function q(e){if(e.which!==1||e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)return;const t=j(e.target);if(!t||t.nodeName!=="A"||t[d]("download")||!t[d]("href")||t.target&&t.target!=="_self"||t.href.indexOf(y.href.match(f)[0])===-1)return;const n=D._.base;if(t.href!==y.href&&(t.href.split("#")[0]===y.href.split("#")[0]||n[0]!=="#"&&A(t.href).indexOf(n)!==0||n[0]==="#"&&t.href.split(n)[0]!==y.href.split(n)[0]||!z(K(t.href),t.title||g.title)))return;e.preventDefault()}function z(e,t,n){if(!S)return P[m]("emit",K(e));e=D._.base+x(e);t=t||g.title;n?S.replaceState(null,t,e):S.pushState(null,t,e);g.title=t;D._.wasFound=false;T();return D._.wasFound}w.m=function(e,t,n){if(O(e)&&(!t||O(t)))z(e,t,n||false);else if(t)this.r(e,t);else this.r("@",e)};w.s=function(){this.off("*");this.$=[]};w.e=function(e){this.$.concat("@").some(function(t){const n=(t==="@"?D._.defaultParser:D._.secondParser)(x(e),x(t));if(typeof n!="undefined"){this[m].apply(null,[t].concat(n));return D._.wasFound=true}},this)};w.r=function(e,t){if(e!=="@"){e=`/${x(e)}`;this.$.push(e)}this.on(e,t)};const B=new F;const D=B.m.bind(B);D._={base:null,getPathFromBase:K,emitStack:[],emitStackLevel:0,debouncedEmit:null,current:null,defaultParser:k,secondParser:null,wasFound:false,hasStarted:false};D.create=function(){const e=new F;const t=e.m.bind(e);t.stop=e.s.bind(e);return t};D.base=function(e){D._.base=e||"#";D._.current=K()};D.exec=function(){T(true)};D.parser=function(e,t){if(!e&&!t){D._.defaultParser=k;D._.secondParser=$}if(e)D._.defaultParser=e;if(t)D._.secondParser=t};D.query=function(){const e={};const t=y.href||D._.current;t.replace(/[?&](.+?)=([^&]*)/g,function(t,n,r){e[n]=r});return e};D.stop=function(){if(D._.hasStarted){if(b){b[u](h,D._.debouncedEmit);b[u](p,D._.debouncedEmit);g[u](v,q)}P[m]("stop");D._.hasStarted=false}};D.start=function(e){if(!D._.hasStarted){if(b){if(document.readyState==="interactive"||document.readyState==="complete"){L(e)}else{document.onreadystatechange=function(){if(document.readyState==="interactive"){setTimeout(function(){L(e)},1)}}}}D._.hasStarted=true}};D.base();D.parser();return D});